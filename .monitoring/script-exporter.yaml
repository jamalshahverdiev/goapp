env:
  - name: GO_URL
    value: devops-test-task-goapp:8080

config: |
  scripts:
    - name: monitoring
      command: /etc/script-exporter/monitoring.sh

scripts:
  monitoring.sh: |
    input=$(curl -s "$GO_URL")
    current_time=$(echo $input | grep -o -E '[0-9]{2}:[0-9]{2}:[0-9]{2}')   
    count=0
    i=0
    while [ $i -le 6 ]; do
      new_input=$(curl -s "$GO_URL")
      new_current_time=$(echo $new_input | grep -o -E '[0-9]{2}:[0-9]{2}:[0-9]{2}')
      echo $new_current_time
      if [ "$new_current_time" != "$current_time" ]; then
        ((count++))
        current_time=$new_current_time
      fi
      i=$(( i + 1 ))
      sleep 1
    done

    if [ $count -eq 1 ]; then
      echo "Available" 
      exit 0
    else
      echo "Not available"
      exit 1
    fi